#!/bin/sh
#
# pre-commit hook to block AI co-authorship attributions in staged files
#
# Blocks commits containing co-authorship credits for:
# - Claude / Anthropic
# - Gemini / Google AI
# - OpenAI / GPT / ChatGPT
# - GitHub Copilot
#

# Combined pattern to catch AI co-authorship variations
BLOCKED_PATTERN='([Cc]o-?[Aa]uthored-?[Bb]y|[Cc]o [Aa]uthored [Bb]y|[Aa]ssisted[- ]?[Bb]y|[Gg]enerated ([Bb]y|[Ww]ith)|[Ww]ritten [Bb]y|[Cc]reated [Bb]y|[Aa][Ii] [Aa]uthor|[Aa][Ii] [Cc]ontributor|[Ww]ith [Hh]elp [Ff]rom|[Ww]ith [Aa]ssistance [Ff]rom|[Pp]aired [Ww]ith).*(([Cc]laude|[Aa]nthropic|[Gg]emini|[Gg]oogle.[Aa][Ii]|[Oo]pen[Aa][Ii]|[Gg][Pp][Tt]|[Cc]hat[Gg][Pp][Tt]|[Cc]opilot|[Gg]ithub [Cc]opilot)|noreply@(anthropic|openai|google))'

# Get list of staged files (excluding deleted files)
STAGED_FILES=$(git diff --cached --name-only --diff-filter=d 2>/dev/null)

if [ -z "$STAGED_FILES" ]; then
    exit 0
fi

FOUND_VIOLATIONS=""

for FILE in $STAGED_FILES; do
    # Check staged content of the file
    MATCHES=$(git show ":$FILE" 2>/dev/null | grep -inE "$BLOCKED_PATTERN" 2>/dev/null)
    if [ -n "$MATCHES" ]; then
        FOUND_VIOLATIONS="$FOUND_VIOLATIONS\n$FILE:\n$MATCHES\n"
    fi
done

if [ -n "$FOUND_VIOLATIONS" ]; then
    echo ""
    echo "=========================================="
    echo "  COMMIT BLOCKED: AI Co-authorship Found"
    echo "=========================================="
    echo ""
    echo "The following staged files contain AI co-authorship attributions:"
    echo ""
    printf "$FOUND_VIOLATIONS"
    echo ""
    echo "Blocked patterns include:"
    echo "  - Co-Authored-By: [AI systems]"
    echo "  - Generated by/with [AI systems]"
    echo "  - Written/Created/Assisted by [AI systems]"
    echo "  - With help/assistance from [AI systems]"
    echo "  - AI-related noreply@ emails"
    echo ""
    echo "Please remove the AI attribution and try again."
    echo ""
    exit 1
fi

exit 0

#!/bin/sh
#
# commit-msg hook to block AI co-authorship attributions in commit messages
#
# Blocks commits containing co-authorship credits for:
# - Claude / Anthropic
# - Gemini / Google AI
# - OpenAI / GPT / ChatGPT
# - GitHub Copilot
#

COMMIT_MSG_FILE="$1"

if [ ! -f "$COMMIT_MSG_FILE" ]; then
    echo "Error: Commit message file not found"
    exit 1
fi

COMMIT_MSG=$(cat "$COMMIT_MSG_FILE")

# Combined pattern to catch AI co-authorship variations
# Uses extended grep with case-insensitive matching

BLOCKED_PATTERN='([Cc]o-?[Aa]uthored-?[Bb]y|[Cc]o [Aa]uthored [Bb]y|[Aa]ssisted[- ]?[Bb]y|[Gg]enerated ([Bb]y|[Ww]ith)|[Ww]ritten [Bb]y|[Cc]reated [Bb]y|[Aa][Ii] [Aa]uthor|[Aa][Ii] [Cc]ontributor|[Ww]ith [Hh]elp [Ff]rom|[Ww]ith [Aa]ssistance [Ff]rom|[Pp]aired [Ww]ith|[Aa]uthor.*:).*(([Cc]laude|[Aa]nthropic|[Gg]emini|[Gg]oogle.[Aa][Ii]|[Oo]pen[Aa][Ii]|[Gg][Pp][Tt]|[Cc]hat[Gg][Pp][Tt]|[Cc]opilot|[Gg]ithub [Cc]opilot)|noreply@(anthropic|openai|google))'

if echo "$COMMIT_MSG" | grep -iE "$BLOCKED_PATTERN" > /dev/null 2>&1; then
    echo ""
    echo "=========================================="
    echo "  COMMIT BLOCKED: AI Co-authorship Found"
    echo "=========================================="
    echo ""
    echo "Your commit message contains an AI co-authorship attribution."
    echo "This repository does not allow AI co-authorship credits."
    echo ""
    echo "Blocked patterns include:"
    echo "  - Co-Authored-By: [AI systems]"
    echo "  - Generated by/with [AI systems]"
    echo "  - Written/Created/Assisted by [AI systems]"
    echo "  - With help/assistance from [AI systems]"
    echo "  - AI-related noreply@ emails"
    echo ""
    echo "Please remove the AI attribution and try again."
    echo ""
    exit 1
fi

exit 0
